Metadata-Version: 2.4
Name: y2karaoke
Version: 1.0.0
Summary: Generate karaoke videos from YouTube URLs with word-by-word highlighting
Author-email: Daniel Tunkelang <dtunkelang@example.com>
License: MIT
Project-URL: Homepage, https://github.com/dtunkelang/y2karaoke
Project-URL: Repository, https://github.com/dtunkelang/y2karaoke
Project-URL: Issues, https://github.com/dtunkelang/y2karaoke/issues
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: End Users/Desktop
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Multimedia :: Video
Classifier: Topic :: Multimedia :: Sound/Audio
Requires-Python: >=3.12
Description-Content-Type: text/markdown
Requires-Dist: yt-dlp>=2024.0.0
Requires-Dist: scenedetect[opencv]>=0.6.0
Requires-Dist: audio-separator>=0.17.0
Requires-Dist: onnxruntime>=1.16.0
Requires-Dist: syncedlyrics>=0.10.0
Requires-Dist: whisperx>=3.1.0
Requires-Dist: moviepy>=2.0.0
Requires-Dist: numpy<2.0.0,>=1.24.0
Requires-Dist: Pillow>=10.0.0
Requires-Dist: pydub>=0.25.0
Requires-Dist: librosa>=0.10.0
Requires-Dist: soundfile>=0.12.0
Requires-Dist: requests>=2.31.0
Requires-Dist: beautifulsoup4>=4.12.0
Requires-Dist: click>=8.0.0
Provides-Extra: romanization
Requires-Dist: korean-romanizer>=0.28.0; extra == "romanization"
Requires-Dist: pypinyin>=0.50.0; extra == "romanization"
Requires-Dist: pykakasi>=2.2.1; extra == "romanization"
Provides-Extra: youtube
Requires-Dist: google-api-python-client>=2.100.0; extra == "youtube"
Requires-Dist: google-auth-oauthlib>=1.0.0; extra == "youtube"
Requires-Dist: google-auth-httplib2>=0.1.0; extra == "youtube"
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: flake8>=6.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"

# y2karaoke

Generate karaoke videos from YouTube URLs or song titles with word-by-word highlighting.

## Features

- **Smart search**: Use YouTube URLs or just search by song title and artist
- Downloads audio from YouTube
- Separates vocals from instrumental using AI (demucs)
- **Hybrid timing system**: Combines synced lyrics (line timing) with WhisperX (word timing) for maximum accuracy
- **Multi-language support**: Automatically romanizes Japanese, Korean, Chinese, Arabic, and Hebrew lyrics with proper spacing
- Renders KaraFun-style karaoke videos with word-by-word highlighting
- **Smart line splitting**: Automatically breaks long lines for better readability
- Optional dynamic video backgrounds generated from the original YouTube video
- Duet-friendly visuals with singer-specific coloring and instrumental-break progress bar
- **Key shifting** (-12 to +12 semitones) to match your vocal range
- **Tempo control** (speed up or slow down) with synchronized lyrics
- **YouTube upload** with unlisted/shareable link
- Caches intermediate files so expensive steps (separation, transcription) are reused across runs

## Installation

### Prerequisites

- **Python 3.12** (required - onnxruntime is not yet available for Python 3.13+)
- ffmpeg

### Setup

```bash
# Clone the repository
git clone https://github.com/dtunkelang/y2karaoke.git
cd y2karaoke

# Create virtual environment with Python 3.12
python3.12 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install in development mode
pip install -e .

# Or install from requirements.txt
pip install -r requirements.txt

# Optional: Install romanization libraries for non-Latin scripts
pip install korean-romanizer pypinyin pykakasi pyarabic
```

### Migration from Old Version

If you have an existing installation, run the migration script:

```bash
python migrate.py
```

### Troubleshooting

If you see `ModuleNotFoundError: No module named 'onnxruntime'`, your Python version is likely too new. Verify you're using Python 3.12:

```bash
python --version  # Should show Python 3.12.x
```

If not, recreate the virtual environment with `python3.12 -m venv venv`.

## Usage

### New CLI Interface (Recommended)

```bash
# Basic usage with YouTube URL
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4

# Or search by song title and artist
y2karaoke generate "taste sabrina carpenter" -o output.mp4

# Using Python module
python -m y2karaoke.cli generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4

# Adjust timing offset (negative = highlight earlier, positive = later)
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --offset -0.5

# Shift key down 3 semitones (for a lower vocal range)
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --key -3

# Slow down to 80% speed (great for learning)
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --tempo 0.8

# Skip the first 8 seconds of audio (e.g., to remove a long intro)
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --audio-start 8

# Use dynamic video backgrounds from the original YouTube video
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --backgrounds

# Use lyrics from a different title/artist (e.g., cover of an original)
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 \
  --lyrics-title "Song Title" --lyrics-artist "Artist Name"

# Combine options: shift key up, slow down, adjust timing
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --key +2 --tempo 0.9 --offset -0.5

# Force reprocess (ignore cache)
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --force

# Upload to YouTube after rendering (unlisted link)
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --upload

# Skip the upload prompt (for scripts/batch mode)
y2karaoke generate "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --no-upload
```

### Cache Management

```bash
# Show cache statistics
y2karaoke cache stats

# Clean up old files (older than 30 days)
y2karaoke cache cleanup --days 30

# Clear cache for specific video
y2karaoke cache clear VIDEO_ID
```

### Legacy Interface (Backward Compatible)

```bash
# Basic usage (same as before)
python karaoke.py "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4

# All old options still work
python karaoke.py "https://youtube.com/watch?v=VIDEO_ID" -o output.mp4 --offset -0.5 --key -3 --tempo 0.8
```

### Options

| Option | Description |
|--------|-------------|
| `-o, --output` | Output video path (default: `{title}_karaoke.mp4`) |
| `--offset` | Timing offset in seconds (negative = highlight earlier, positive = later, default: 0.0) |
| `--key` | Shift key by N semitones (-12 to +12, default: 0) |
| `--tempo` | Tempo multiplier (0.5 = half speed, 2.0 = double, default: 1.0) |
| `--audio-start` | Start audio processing from this many seconds into the track (skip intro; default: 0.0) |
| `--lyrics-title` | Override song title used when searching for lyrics (useful for covers) |
| `--lyrics-artist` | Override artist used when searching for lyrics (useful for covers) |
| `--upload` | Upload to YouTube as unlisted video after rendering |
| `--no-upload` | Skip the upload prompt (for batch/script mode) |
| `--backgrounds` | Use video backgrounds extracted from the original YouTube video |
| `--work-dir` | Working directory for intermediate files (default: `~/.cache/karaoke/{video_id}`) |
| `--keep-files` | Keep intermediate files (audio, stems, etc.) |
| `--force` | Force re-download and re-process even if cached files exist |

## Advanced: module-level CLIs

For debugging or experimenting with individual steps, you can run the core modules directly:

- **Download only (audio metadata + WAV)**
  ```bash
  python -m y2karaoke.core.downloader "https://youtube.com/watch?v=VIDEO_ID"
  ```
  Downloads the audio track to `./output` and prints basic metadata (title, artist, duration).

- **Separate vocals and instrumental for a local WAV file**
  ```bash
  python -m y2karaoke.core.separator path/to/audio.wav
  ```
  Writes separated stems into `./output` and prints the paths for vocals and instrumental.

- **Fetch and inspect lyrics/timing**
  ```bash
  python -m y2karaoke.core.lyrics "Song Title" "Artist Name" [optional_vocals.wav]
  ```
  Prints detected lines (and duet information when available). If you provide a vocals WAV, it can fall back to WhisperX transcription.

- **Apply audio effects (key/tempo) to an existing WAV**
  ```bash
  python -m y2karaoke.core.audio_effects input.wav output.wav <semitones> [tempo_multiplier]
  ```
  Example: `python -m y2karaoke.core.audio_effects input.wav output_key-3_tempo0.8.wav -3 0.8`

- **Test rendering (single preview frame)**
  ```bash
  python -m y2karaoke.core.renderer
  ```
  Renders a sample frame to `test_frame.png` for quickly checking fonts/layout.

- **Upload an existing MP4 to YouTube**
  ```bash
  python -m y2karaoke.core.uploader output.mp4 [title] [artist]
  ```
  Uses your saved OAuth credentials to upload as an unlisted video.

- **Inspect video backgrounds / scene detection**
  ```bash
  python -m y2karaoke.core.backgrounds path/to/video.mp4
  ```
  Runs scene detection and saves a sample processed background to `test_background.png`.

## How It Works

1. **Download**: Downloads audio from YouTube using yt-dlp
2. **Separate**: Removes vocals using demucs AI model, keeps instrumental
3. **Lyrics**: Fetches synced lyrics when available and combines them with WhisperX transcription for hybrid alignment - synced lyrics provide accurate line timing, WhisperX provides precise word-level timing
4. **Audio Effects**: Applies key shift and/or tempo changes (if requested)
5. **Render**: Creates video with word-by-word highlighting, lyrics timing adjusted to match tempo

## International lyrics and romanization

For songs with non-Latin scripts, y2karaoke automatically romanizes lyrics before rendering:

- **Korean (Hangul)**: Romanized using `korean-romanizer` (Revised Romanization style) when available.
- **Chinese (Han characters)**: Romanized to **pinyin without tone marks** using `pypinyin`, while leaving non-Chinese text untouched.
- **Japanese (hiragana/katakana/kanji)**: Romanized to **romaji** using `pykakasi`, preserving word boundaries and spacing.
- **Arabic**: Romanized using simple transliteration mapping to Latin script.
- **Hebrew**: Romanized using simple transliteration mapping to Latin script.

Romanization is **best-effort** and only applied when the corresponding libraries are installed. If synced lyrics are in non-Latin scripts but Genius has romanized versions, the system will automatically romanize the synced lyrics to match for optimal hybrid alignment. Works seamlessly with mixed-language songs (e.g., English/Korean, English/Japanese).

## Video Style

- 1920x1080 resolution at 30fps
- Dark gradient background (blue to purple) by default, or dynamic video backgrounds when `--backgrounds` is enabled
- Four lines visible at a time with smart scrolling
- Long lines automatically split for better readability (75% screen width threshold)
- Current and already-sung words highlighted in gold (KaraFun-style — they stay gold once sung)
- White for upcoming words on the current and next line
- Optional singer-specific colors in duet songs
- Progress bar during long instrumental intros and breaks
- Intro splash screen and outro logo screen

## Caching

Intermediate files are cached in `~/.cache/karaoke/{video_id}/` by default, including downloaded audio, separated stems, processed instrumentals for particular key/tempo settings, and lyrics/timing metadata. This allows fast re-runs when adjusting timing offsets, key, or tempo without repeating the expensive separation and transcription steps.

## YouTube Upload Setup

To enable YouTube uploads, you need to set up Google OAuth credentials:

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project (or select existing)
3. Enable the **YouTube Data API v3**
4. Go to **Credentials** → **Create Credentials** → **OAuth client ID**
5. Select **Desktop app** as application type
6. Download the JSON file
7. Save it as `~/.cache/karaoke/client_secrets.json`

On first upload, a browser window will open for authentication. Credentials are cached for future use.

## License

MIT
